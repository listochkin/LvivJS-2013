<!DOCTYPE html>
<html ng-app>
    <head>
        <title></title>
        <link rel="stylesheet" href="css/styles.css">
    </head>
    <body>
        <script src="js/vendor.js"></script>

        <script>
            var twitsArr = [];

            angular.injector(['ng']).invoke(function($rootScope) {
               var scope = $rootScope.$new();

               scope.$watch(function($scope) {
                 $scope.twits = twitsArr;
               }); // initialize the watch

               scope.$digest();
            });

            function TwitDashboard($scope){
                $scope.twits = [];
                //$scope.twits.push(twit);

                window.addEventListener('message', function (message) {
                    var twit = JSON.parse(message.data);

                    $scope.twits.push(twit);
                    $scope.$apply();
                });

                $scope.twitsLoaded = function (){
                    return $scope.twits.length;
                };
            }
        </script>

        <h2>Angular JS</h2>
        <div ng-controller="TwitDashboard">
            <ul class="unstyled">
                <li ng-repeat="twit in twits">
                    <p><span>{{twit.user.name}}</span> <i>at</i> <span>{{twit.created_at}}</span></p>
                    <p>{{twit.text}}</p>
                </li>
            </ul>
        </div>

    </body>
</html>
